(function(){var t={6274:function(){},7659:function(t,e,i){"use strict";var s=i(7203),a=i.n(s),o=i(6848),n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("SideBar"),e("div",{staticClass:"content"},[e("transition",{attrs:{name:t.transitionName,mode:"out-in"}},[e("keep-alive",{attrs:{include:["PropertyComparison","ExchangeSquare"]}},[e("router-view",{staticClass:"router-view"})],1)],1)],1)],1)},l=[],r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"sidebar"},[e("div",{staticClass:"header"},[e("div",{staticClass:"icon",on:{click:t.headerClick}},[e("i",{staticClass:"el-icon-office-building",staticStyle:{color:"#ffd04f","font-size":"32px"}}),e("span",{staticClass:"header-text"},[t._v("安心好住:)")])]),e("div",{staticClass:"text",on:{click:t.headerClick}},[t._v(" 找房 ")])]),e("div",{staticClass:"main"},[e("el-menu",{ref:"menu",staticClass:"el-menu-vertical-demo",attrs:{router:"","default-active":"PropertyIllustration","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},[e("el-menu-item",{attrs:{index:"PropertyIllustration"}},[e("i",{staticClass:"el-icon-s-home"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("房源图示")])]),e("el-menu-item",{attrs:{index:"RealsceneAnalysis"}},[e("i",{staticClass:"el-icon-location"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("实景分析")])]),e("el-menu-item",{attrs:{index:"ThermalComparison"}},[e("i",{staticClass:"el-icon-platform-eleme"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("热力比较")])]),e("el-menu-item",{attrs:{index:"ExchangeSquare"}},[e("i",{staticClass:"el-icon-s-comment"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("交流广场")])]),e("el-menu-item",{attrs:{index:"PropertyComparison"}},[e("i",{staticClass:"el-icon-s-data"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("房源对比")])])],1)],1),t._m(0)])},c=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"footer"},[e("span",{staticClass:"iconfont icon-tuichu exit"},[t._v("退出系统")])])}],h=(i(4114),{name:"SideBar",data(){return{transitionName:"slide-left"}},watch:{$route(t,e){const i=t.meta.depth||0,s=e.meta.depth||0;this.transitionName=i<s?"slide-right":"slide-left"}},methods:{headerClick(){"/"!==this.$route.path&&"/PropertyIllustration"!==this.$route.path&&(this.$refs.menu.activeIndex="PropertyIllustration",this.$router.push("/PropertyIllustration"))}}}),u=h,p=i(1656),d=(0,p.A)(u,r,c,!1,null,"5a38abc2",null),m=d.exports,f=i(3518),g={name:"app",components:{SideBar:m},data(){return{transitionName:"fade"}},mounted(){this.loadHouseData()},methods:{...(0,f.i0)(["loadHouseData"])}},y=g,v=(0,p.A)(y,n,l,!1,null,null,null),b=v.exports,w=i(6178),C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"house-map",on:{click:t.closeFloatingOnOutside}},[e("BaiduMap",{ref:"baiduMap",staticClass:"map-layer",on:{"show-house-detail":t.onShowHouseDetail}}),e("transition",{attrs:{name:"fade-scale"}},[t.floatingDetail.visible?e("div",{staticClass:"floating-detail-card",on:{click:function(t){t.stopPropagation()}}},[e("HouseDetail",{attrs:{feature:t.floatingDetail.house}}),e("div",{staticClass:"float-wish-icon",on:{click:t.floatCardAddToWishList}},[e("i",{staticClass:"el-icon-star-off",staticStyle:{"font-size":"24px",color:"#ffd04b"}})])],1):t._e()]),e("el-button",{staticClass:"wish-icon",attrs:{circle:""},on:{click:t.toggleWishList}},[e("i",{staticClass:"el-icon-star-off",staticStyle:{"font-size":"24px",color:"#ffd04b"}})]),e("transition",{attrs:{name:"slide-left"}},[t.isWishListVisible?e("wish-list",{on:{close:function(e){t.isWishListVisible=!1},locate:t.handleLocate,click:function(t){t.stopPropagation()}}}):t._e()],1),e("div",{staticClass:"components"},[e("div",{staticClass:"tools"},[e("div",{staticClass:"input rental-method"},[e("el-select",{attrs:{multiple:"",clearable:"","collapse-tags":"","default-first-option":"",placeholder:"请选择租房方式"},model:{value:t.check.rental_method,callback:function(e){t.$set(t.check,"rental_method",e)},expression:"check.rental_method"}},t._l(t.input.rental_method,function(t,i){return e("el-option",{key:i,attrs:{label:t.label,value:t.value}})}),1)],1),e("div",{staticClass:"input house-size"},[e("el-select",{attrs:{multiple:"",clearable:"","collapse-tags":"","default-first-option":"",placeholder:"请选择租房规格"},model:{value:t.check.house_size,callback:function(e){t.$set(t.check,"house_size",e)},expression:"check.house_size"}},t._l(t.input.house_size,function(t,i){return e("el-option",{key:i,attrs:{label:t.label,value:t.value}})}),1)],1),e("div",{staticClass:"input district"},[e("el-autocomplete",{attrs:{"fetch-suggestions":t.querySearchAsync,"suffix-icon":"el-icon-location",placeholder:"请输入租房地点",clearable:"","value-key":"building"},model:{value:t.check.district,callback:function(e){t.$set(t.check,"district",e)},expression:"check.district"}})],1),e("div",{staticClass:"input price"},[e("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"最低",clearable:""},model:{value:t.check.price.min,callback:function(e){t.$set(t.check.price,"min",e)},expression:"check.price.min"}},t._l(t.priceOptions,function(t,i){return e("el-option",{key:i,attrs:{label:t.label,value:t.value}})}),1),e("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"最高",clearable:""},model:{value:t.check.price.max,callback:function(e){t.$set(t.check.price,"max",e)},expression:"check.price.max"}},t._l(t.priceOptions,function(t,i){return e("el-option",{key:i,attrs:{label:t.label,value:t.value}})}),1)],1),e("div",{staticClass:"search-button",on:{click:t.search}},[e("i",{staticClass:"el-icon-search"})])]),e("div",{staticClass:"main-content"},[t.filteredHouses.length>0?t._l(t.filteredHouses,function(i,s){return e("HouseDetail",{key:s,attrs:{feature:i},on:{clickOnDetail:t.showDetail}})}):e("div",{staticClass:"no-data"},[t._v(" 没有找到符合条件的房源，请调整筛选条件重试。 ")])],2)]),e("el-dialog",{attrs:{visible:t.isDetailVisible,title:"房源详情",width:"60%","destroy-on-close":!0,center:!0,"custom-class":"house-detail-dialog","append-to-body":!0},on:{"update:visible":function(e){t.isDetailVisible=e}}},[t.selectedHouse?e("div",{staticClass:"detail-content"},[e("div",{staticClass:"detail-header"},[e("el-image",{staticClass:"header-image",attrs:{src:t.selectedHouse.pic_link,fit:"cover"}}),e("div",{staticClass:"header-overlay"},[e("h1",{staticClass:"header-title"},[t._v(t._s(t.selectedHouse.title))]),e("div",{staticClass:"header-price"},[e("span",{staticClass:"price-amount"},[t._v(t._s(t.selectedHouse.price))]),e("span",{staticClass:"price-unit"},[t._v(t._s(t.selectedHouse.unit))])])])],1),e("div",{staticClass:"detail-body"},[e("div",{staticClass:"toolbar"},[e("el-button",{attrs:{type:"warning",icon:"el-icon-location",round:"",plain:""},on:{click:function(e){return t.handleLocate(t.selectedHouse)}}},[t._v("定位 ")]),e("el-button",{attrs:{type:"warning",icon:"el-icon-star-off",round:""},on:{click:t.addToWishList}},[t._v("加入心愿单")])],1),e("div",{staticClass:"info"},[e("el-descriptions",{attrs:{column:2,border:"",size:"small"}},[e("el-descriptions-item",{attrs:{label:"标签"}},[t._v(t._s(t.selectedHouse.tag))]),e("el-descriptions-item",{attrs:{label:"户型"}},[t._v(t._s(t.selectedHouse.room))]),e("el-descriptions-item",{attrs:{label:"地址"}},[t._v(t._s(t.selectedHouse.address))]),e("el-descriptions-item",{attrs:{label:"楼盘"}},[t._v(t._s(t.selectedHouse.building))]),e("el-descriptions-item",{attrs:{label:"联系人"}},[t._v(t._s(t.selectedHouse.contact))]),e("el-descriptions-item",{attrs:{label:"描述",span:2}},[t._v(t._s(t.selectedHouse.description))])],1)],1)])]):t._e()])],1)},_=[],k=(i(8111),i(2489),i(7588),i(1701),i(3579),function(){var t=this,e=t._self._c;return e("div",{staticClass:"map",attrs:{id:"map"}})}),D=[],x=i(9071),P=i(8699),L=(i(2488),i(9298)),S=i(4364),M=i(9073),$=i(1242),A=i(8047),H=(i(2239),i(6505)),z=i(8343),T=i(5782),I=i(6121),O=i(856),W=i(478),G=i(8225),E=i(5274),B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main",on:{click:t.addClickEvent}},[e("div",{staticClass:"picture"},[e("img",{attrs:{src:this.feature.pic_link,alt:""}})]),e("div",{staticClass:"main-content"},[e("div",{staticClass:"title"},[e("span",[t._v(" "+t._s(t.feature.title)+" ")])]),e("div",{staticClass:"location"},[e("span",[t._v(" "+t._s(t.feature.room+t.feature.building+t.feature.address)+" ")])]),e("div",{staticClass:"description"},[e("span",[t._v(t._s(t.feature.description))])]),e("div",{staticClass:"contact"},[e("i",{staticClass:"el-icon-user-solid"}),e("span",[t._v(t._s(t.feature.contact))])]),e("div",{staticClass:"price"},[e("span",[t._v(t._s(t.feature.price))]),e("span",[t._v("元/月")])]),e("div",{staticClass:"tag"},[e("span",[t._v(t._s(t.feature.tag))])])])])},R=[],V={name:"HouseDetail",props:{feature:{type:Object,default:()=>({id:"",title:"",pic_link:"",price:"",unit:"元/月",room:"",address:"",building:"",description:"",contact:"",create_time:"",tag:""})}},emits:["clickOnDetail"],methods:{addClickEvent(){this.$emit("clickOnDetail",this.feature)}}},F=V,j=(0,p.A)(F,B,R,!1,null,"900ccf86",null),N=j.exports,Z={name:"OpenlayersIndex",components:{HouseDetail:N},data(){return{center:[106.5778767,29.5547398],popupElement:null,popupOverlay:null}},methods:{initMap(){this.loadLayers(),this.view=new P.Ay({center:this.center,zoom:15,maxZoom:18,minZoom:14,projection:"EPSG:4326"}),this.initPopup(),this.clusterLayer.setVisible(!1),this.map=new x.A({target:"map",layers:[this.gaodeVectorLayer,this.gaodeLabelLayer,this.buildingslayer,this.clusterLayer],view:this.view}),this.addClickEvent(),this.map.on("moveend",()=>{const t=this.map.getView().getZoom();t<16?(this.clusterLayer.setVisible(!0),this.buildingslayer.setVisible(!1)):(this.clusterLayer.setVisible(!1),this.buildingslayer.setVisible(!0))})},loadLayers(){this.gaodeVectorSource=new L.A({url:"https://webrd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",attributions:"© 高德地图",crossOrigin:"anonymous"}),this.gaodeLabelSource=new L.A({url:"https://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",attributions:"© 高德地图",crossOrigin:"anonymous"}),this.houseDetailSource=new M.A({loader:(t,e,i)=>{fetch("/data/anjuke_yuzhong.json").then(t=>t.json()).then(t=>{const e=t.anjuke_yuzhong.map(t=>new O.A({geometry:new G.A([parseFloat(t.longitude),parseFloat(t.latitude)]),id:t.id,title:t.title,tag:t.tag,room:t.room,address:t.address,building:t.building,description:t.description,contact:t.contact,price:t.price,unit:t.unit,create_time:t.create_time}));this.houseDetailSource.addFeatures(e)}).catch(t=>{console.error("加载数据失败:",t)})}}),this.clusterSource=new S.A({source:this.houseDetailSource,distance:100,minDistance:20}),this.gaodeVectorLayer=new A.A({source:this.gaodeVectorSource}),this.gaodeLabelLayer=new A.A({source:this.gaodeLabelSource}),this.buildingslayer=new $.A({source:this.houseDetailSource,style:new H.Ay({image:new E.A({radius:6,fill:new z.A({color:"rgb(236,111,158)"}),stroke:new T.A({color:"rgb(180,80,120)",width:2})})})}),this.clusterLayer=new $.A({source:this.clusterSource,style:this.clusterStyleFunction})},clusterStyleFunction(t){const e=t.get("features").length,i=Math.min(8+2*Math.log(e),20);let s="rgba(216,156,178,0.8)";return e>10&&(s="rgba(202,100,141,0.8)"),e>50&&(s="rgba(232,0,97,0.8)"),new H.Ay({image:new E.A({radius:i,fill:new z.A({color:s}),stroke:new T.A({color:"white",width:2})}),text:new I.A({text:e>1?e.toString():"",fill:new z.A({color:"white"}),font:"bold 12px sans-serif"})})},initPopup(){this.popupElement=document.createElement("div"),this.popupElement.className="ol-popup",this.popupElement.style.backgroundColor="white",this.popupElement.style.border="1px solid #f3f4fb";const t=document.createElement("div");t.className="ol-popup-content",this.popupElement.appendChild(t),this.popupOverlay=new W.A({element:this.popupElement,positioning:"bottom-center",stopEvent:!1,offset:[0,-10]})},addClickEvent(){this.map.on("singleclick",t=>{this.popupOverlay.setPosition(void 0);const e=this.map.forEachFeatureAtPixel(t.pixel,t=>t);e&&e.get("id")&&this.showHouseInfo(e,t.coordinate)})},showHouseInfo(t,e){const i={title:t.get("title")||"未知标题",price:t.get("price")||"未知",unit:t.get("unit")||"元/月",room:t.get("room")||"未知",address:t.get("address")||"未知",building:t.get("building")||"未知",description:t.get("description")||"无描述",contact:t.get("contact")||"未知",create_time:t.get("create_time")||"未知",tag:t.get("tag")||""},s=o["default"].extend(N),a=new s({propsData:{feature:i}});a.$mount(),this.popupElement.querySelector(".ol-popup-content").innerHTML="",this.popupElement.querySelector(".ol-popup-content").appendChild(a.$el),this.popupOverlay.setPosition(e)}},mounted(){this.initMap(),this.map&&this.popupOverlay&&this.map.addOverlay(this.popupOverlay)},update(){}},q=Z,U=(0,p.A)(q,k,D,!1,null,"13ee1478",null),Y=U.exports,J=function(){var t=this,e=t._self._c;return e("div",{ref:"map",attrs:{id:"map"}})},X=[],K=i(4373),Q={name:"BaiduMap",data(){return{map:null,view:null,layer:null,clusterlayer:null,center:[106.5778767,29.5587398]}},mounted(){this.initMap()},beforeDestroy(){this.layer&&this.layer.destroy(),this.clusterlayer&&this.clusterlayer.destroy(),this.view&&this.view.destroy(),this.map&&this.map.destroy()},methods:{initMap(){BMapGL.coordType="bd09",this.map=new BMapGL.Map("map",{enableRotate:!0,enableTilt:!0});const t=new BMapGL.Point(106.5778767,29.5587398);this.map.centerAndZoom(t,16),this.map.setTilt(45),this.map.enableScrollWheelZoom(),this.view=new mapvgl.View({map:this.map,events:{click:!0}}),this.initCluster()},async initCluster(){const t=await K.A.get("/data/new_anjuke_yuzhong.json"),e=t.data,i=this.formatData2D(e);this.clusterlayer=new mapvgl.ClusterLayer({color:({properties:t})=>t.color,showText:!0,minSize:30,maxSize:60,clusterRadius:100,maxZoom:16,minZoom:14,gradient:{0:"rgb(228,154,183)",.2:"rgb(214,121,160)",.4:"rgb(218,79,131)",.6:"rgba(214,7,92,0.8)",1:"rgba(191,7,82,1)"},textOptions:{fontSize:12,fontFamily:"Microsoft Yahei",margin:[5,5],color:"white",format:function(t){return t}},shape:"circle",enablePicked:!0,onClick:t=>{if(!t||void 0===t.dataIndex||-1===t.dataIndex)return;const{dataItem:e}=t,i=this.map,s=e.children&&Array.isArray(e.children)&&e.children.length>0;if(s){const[t,s]=e.geometry.coordinates,a=new BMapGL.Point(t,s),o=Math.min(i.getZoom()+3,20);return i.centerAndZoom(a,o),void setTimeout(()=>{const t=e.children[0];t?.properties?.feature&&this.$emit("show-house-detail",e.properties.feature)},450)}e.properties?.feature&&this.$emit("show-house-detail",e.properties.feature)}}),this.view.addLayer(this.clusterlayer),this.clusterlayer.setData(i)},async initGLMap(){const t=await K.A.get("http://146.56.245.149:3000/buildings.geojson"),e=t.data.features,i=this.formatData3D(e);this.layer=new mapvgl.ShapeLayer({color:({properties:t})=>t.color,style:"normal",enablePicked:!0,selectedColor:"rgba(255, 208, 75, 0.9)",autoSelect:!0,riseTime:800,onClick:t=>{console.log(t)}}),this.view.addLayer(this.layer),this.layer.setData(i)},formatData2D(t){return t.map(t=>({geometry:{type:"Point",coordinates:[t.longitude,t.latitude]},properties:{id:t.uid||t.id||t._id||Date.now(),feature:t,color:"rgba(255, 208, 75, 0.9)"}}))},formatData3D(t){return t.map(t=>({geometry:{type:"Polygon",coordinates:[t.geometry.coordinates[0][0].map(t=>[t[0],t[1]])]},properties:{height:t.properties.height,color:"rgba(200, 200, 255, 0.9)"}}))}}},tt=Q,et=(0,p.A)(tt,J,X,!1,null,"5da5b90e",null),it=et.exports,st=function(){var t=this,e=t._self._c;return e("div",{staticClass:"wish-list",on:{click:function(t){t.stopPropagation()}}},[e("h3",{staticClass:"title"},[t._v("我的心愿单")]),t.wishList.length?e("el-table",{attrs:{data:t.wishList,border:"",stripe:""}},[e("el-table-column",{attrs:{prop:"title",label:"房源名称",width:"180"}}),e("el-table-column",{attrs:{prop:"contact",label:"联系人",width:"120"}}),e("el-table-column",{attrs:{prop:"price",label:"租金 (元/月)"}}),e("el-table-column",{attrs:{prop:"room",label:"房屋规格 (㎡)"}}),e("el-table-column",{attrs:{label:"操作",width:"110",align:"center"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("div",{staticClass:"action-buttons"},[e("el-button",{staticClass:"action-btn locate-btn",attrs:{size:"small",icon:"el-icon-location"},on:{click:function(e){return t.locateHouse(i.row)}}}),e("el-button",{staticClass:"action-btn contact-btn",attrs:{size:"small",icon:"el-icon-phone"},on:{click:function(e){return t.contactPerson(i.row.contact)}}}),e("el-button",{staticClass:"action-btn remove-btn",attrs:{size:"small",icon:"el-icon-delete"},on:{click:function(e){return t.removeHouse(i.row.id)}}})],1)]}}])})],1):e("el-empty",{attrs:{description:"暂无收藏房源"}})],1)},at=[],ot={name:"WishList",computed:{...(0,f.aH)(["wishList"])},methods:{...(0,f.PY)(["removeFromWishList"]),locateHouse(t){this.$emit("locate",t)},contactPerson(t){alert(`联系: ${t}`)},removeHouse(t){this.removeFromWishList(t)}}},nt=ot,lt=(0,p.A)(nt,st,at,!1,null,"3e947b4e",null),rt=lt.exports,ct={name:"PropertyIllustration",components:{WishList:rt,BaiduMap:it,HouseDetail:N,OpenlayersIndex:Y},data(){return{isWishListVisible:!1,isDetailVisible:!1,selectedHouse:null,feature:{},floatingDetail:{visible:!1,house:null},filteredHouses:[],input:{rental_method:[{value:"整租",label:"整租"},{value:"合租",label:"合租"}],house_size:[{value:"1室",label:"1室"},{value:"2室",label:"2室"},{value:"3室",label:"3室"},{value:"4室",label:"4室"},{value:"5室",label:"5室"},{value:"6室",label:"6室"},{value:"7室",label:"7室"}],district:{result:[],state:"",timeout:null}},check:{rental_method:[],house_size:[],district:"",price:{min:"",max:""}}}},computed:{...(0,f.aH)(["houseDetail"]),priceRange(){if(!Array.isArray(this.houseDetail)||0===this.houseDetail.length)return{min:0,max:0};const t=this.houseDetail.map(t=>{const e=parseFloat(t.price);return isNaN(e)?0:e}).filter(t=>t>0);if(0===t.length)return{min:0,max:0};const e=Math.min(...t),i=Math.max(...t);return{min:e,max:i}},priceOptions(){const{min:t,max:e}=this.priceRange;if(0===t&&0===e)return[{value:"不限",label:"不限"}];const i=[{value:"不限",label:"不限"}],s=Math.ceil((e-t)/5);for(let a=0;a<=5;a++){const o=t+a*s,n=t+(a+1)*s;if(o<=e){const t=5===a?o:n;i.push({value:t,label:t})}}return i}},watch:{houseDetail:{handler(t){this.filteredHouses=t},immediate:!0},"check.price.min":function(t,e){this.validateMinPrice(t)},"check.price.max":function(t,e){this.validateMaxPrice(t)}},mounted(){this.houseDetail.length||this.$store.dispatch("loadHouseData")},beforeDestroy(){this.$refs.baiduMap?.$el&&this.$refs.baiduMap.$el.removeEventListener("click",this.handleMapClick)},methods:{closeFloatingOnOutside(t){t.target.closest(".floating-detail-card")||t.target.closest(".wish-icon")||t.target.closest(".wish-list")||(this.floatingDetail.visible=!1,this.isWishListVisible=!1)},onShowHouseDetail(t){void 0!==t&&null!==t&&(this.floatingDetail.visible=!1,setTimeout(()=>{this.floatingDetail={visible:!0,house:t},this.handleLocate(t)},100))},handleMapClick(t){t.target===this.$refs.baiduMap.$el&&(this.floatingDetail.visible=!1)},querySearchAsync(t,e){clearTimeout(this.input.district.timeout),this.input.district.timeout=setTimeout(()=>{let i=[];Array.isArray(this.houseDetail)&&(i=t?this.houseDetail.filter(this.createStateFilter(t)):[...this.houseDetail]),this.input.district.result=i;const s=new Map;i.forEach(t=>{s.has(t.building)||s.set(t.building,t)});const a=Array.from(s.values()).map(t=>({...t,value:t.building}));e(a)},300)},createStateFilter(t){return e=>-1!==e.building.toLowerCase().indexOf(t.toLowerCase())},validateMinPrice(t){if("不限"!==t&&"不限"!==this.check.price.max&&t&&this.check.price.max){const e=parseFloat(t),i=parseFloat(this.check.price.max);!isNaN(e)&&!isNaN(i)&&e>i&&this.$nextTick(()=>{this.check.price.max=t})}},validateMaxPrice(t){if("不限"!==t&&"不限"!==this.check.price.min&&t&&this.check.price.min){const e=parseFloat(this.check.price.min),i=parseFloat(t);!isNaN(e)&&!isNaN(i)&&e>i&&this.$nextTick(()=>{this.check.price.min=t})}},toggleWishList(){this.isWishListVisible=!this.isWishListVisible},handleLocate(t){if(!this.$refs.baiduMap||!this.$refs.baiduMap.map)return void this.$notify.error({title:"警告",message:"地图未初始化",duration:2e3,position:"top-right",offset:80});const e=new BMapGL.Point(t.longitude,t.latitude);this.$refs.baiduMap.map.centerAndZoom(e,20),this.isDetailVisible=!1,this.isWishListVisible=!1},search(){let t=this.houseDetail;this.check.rental_method.length>0&&(t=t.filter(t=>this.check.rental_method.some(e=>t.description.includes(e)))),this.check.house_size.length>0&&(t=t.filter(t=>{const e=t.room.split("室")[0]+"室";return this.check.house_size.includes(e)})),this.check.district&&(t=t.filter(t=>t.building.toLowerCase().includes(this.check.district.toLowerCase())));const e="不限"!==this.check.price.min&&this.check.price.min?parseFloat(this.check.price.min):-1/0,i="不限"!==this.check.price.max&&this.check.price.max?parseFloat(this.check.price.max):1/0;t=t.filter(t=>{const s=parseFloat(t.price);return!isNaN(s)&&s>=e&&s<=i}),this.filteredHouses=t},showDetail(t){this.selectedHouse=t,this.isDetailVisible=!0},addToWishList(){null===this.selectedHouse||this.selectedHouse.length<1||(this.$store.commit("addToWishList",this.selectedHouse),this.$notify.success({title:"提示",message:"已加入心愿单",duration:2e3,position:"top-right",offset:80}))},floatCardAddToWishList(){this.selectedHouse=this.floatingDetail.house,this.addToWishList(),this.floatingDetail.visible=!1}}},ht=ct,ut=(0,p.A)(ht,C,_,!1,null,"71e96262",null),pt=ut.exports,dt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"house-viewing",on:{click:t.closeFloatingOnOutside}},[e("AnalysisIndex",{ref:"analysisIndex",staticClass:"map-layer",attrs:{checkboxGroup:t.checkboxGroup,origin:t.origin,destination:t.destination,"planning-methods":t.planningMethods,chooseLayer:t.chooseLayer,selectMode:t.selectMode},on:{"show-house-detail":t.onShowHouseDetail,"update:origin":function(e){t.origin=e},"update:destination":function(e){t.destination=e},"update:selectMode":function(e){t.selectMode=e},"update:centerPoint":function(e){t.centerPoint=e},"route-info-update":t.onRouteInfoUpdate,"isochrone-loading":function(e){t.showIsochroneTip=e},"isochrone-complete":t.onIsochroneComplete}}),e("transition",{attrs:{name:"fade-scale"}},[t.floatingDetail.visible?e("div",{staticClass:"floating-detail-card",on:{click:function(t){t.stopPropagation()}}},[e("HouseDetail",{attrs:{feature:t.floatingDetail.house}}),e("div",{staticClass:"float-wish-icon",on:{click:t.floatCardAddToWishList}},[e("i",{staticClass:"el-icon-star-off",staticStyle:{"font-size":"24px",color:"#ffd04b"}})])],1):t._e()]),e("transition",{attrs:{name:"fade"}},[t.showRoutePanel?e("div",{staticClass:"route-info-panel"},[e("div",{staticClass:"panel-header"},[e("span",{staticClass:"title"},[t._v("路径规划结果")]),e("i",{staticClass:"el-icon-close",on:{click:function(e){t.showRoutePanel=!1}}})]),e("div",{staticClass:"panel-content"},t._l(t.routeInfos,function(i){return e("div",{key:i.type,staticClass:"route-item"},[e("span",{staticClass:"type",style:{color:"驾车"===i.type?"#e74c3c":"公共交通"===i.type?"#3498db":"#27ae60"}},[t._v(" "+t._s(i.type)+"： ")]),e("span",[t._v(t._s(i.distance)+"，预计 "+t._s(i.duration))])])}),0)]):t._e()]),e("transition",{attrs:{name:"fade-scale"}},[t.showIsochroneTip?e("div",{ref:"customIsochroneTip",staticClass:"custom-isochrone-loading",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"loading-content"},[e("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"32px",color:"#ffd04b","margin-bottom":"12px"}}),e("div",{staticClass:"text",staticStyle:{"font-size":"16px","font-weight":"600",color:"#333"}},[t._v(" 正在计算驾车时间 ")]),e("div",{staticClass:"subtext",staticStyle:{"font-size":"14px",color:"#666","margin-top":"8px"}},[t._v(" 分析 "+t._s(t.chooseLayer)+" 等时圈 · 预计 10-30 秒 ")]),e("div",{staticClass:"progress-hint",staticStyle:{"margin-top":"16px","font-size":"13px",color:"#999"}},[t._v(" 可继续操作地图，稍后自动完成 ")])])]):t._e()]),e("transition",{attrs:{name:"slide-down"}},[t.showIsochroneLegend?e("div",{staticClass:"isochrone-legend-card"},[e("div",{staticClass:"legend-header"},[e("span",{staticClass:"title"},[t._v("驾车等时圈分析结果")]),e("i",{staticClass:"el-icon-close",on:{click:t.clearSynchrone}})]),e("div",{staticClass:"legend-body"},t._l(["0-5分钟","5-10分钟","10-15分钟","15-20分钟","20-30分钟"],function(i,s){return e("div",{key:s,staticClass:"legend-item",class:{disabled:s>=t.isochroneLayersCount}},[e("span",{staticClass:"color-block",style:{backgroundColor:t.thresholdColors[s]}}),e("span",{staticClass:"time-text"},[t._v(t._s(i))])])}),0)]):t._e()]),e("el-button",{staticClass:"wish-icon",attrs:{circle:""},on:{click:t.toggleWishList}},[e("i",{staticClass:"el-icon-star-off",staticStyle:{"font-size":"24px",color:"#ffd04b"}})]),t.isWishListVisible?e("wish-list",{on:{close:function(e){t.isWishListVisible=!1},locate:t.handleLocate}}):t._e(),e("div",{staticClass:"components"},[e("div",{staticClass:"tools"},[e("div",{staticClass:"add-layers"},[e("span",{staticClass:"title"},[t._v("加载设施点图层")]),e("div",{staticClass:"layers"},[e("el-checkbox-group",{attrs:{size:"small"},model:{value:t.checkboxGroup,callback:function(e){t.checkboxGroup=e},expression:"checkboxGroup"}},t._l(["公园","学校","商场","医院"],function(i,s){return e("el-checkbox-button",{key:s,attrs:{label:i}},[t._v(" "+t._s(i)+" ")])}),1)],1)]),e("div",{staticClass:"analysis-tools"},[e("div",{staticClass:"route-planning"},[e("span",{staticClass:"title"},[t._v("路径规划")]),e("div",{staticClass:"setting"},[e("div",{staticClass:"point-to-point"},[e("el-checkbox-group",{attrs:{size:"small"},model:{value:t.planningMethods,callback:function(e){t.planningMethods=e},expression:"planningMethods"}},t._l(["驾车","公共交通","步行"],function(i,s){return e("el-checkbox-button",{key:s,attrs:{label:i}},[t._v(" "+t._s(i)+" ")])}),1),e("el-input",{attrs:{placeholder:"点击右侧按钮选择起点"},model:{value:t.origin,callback:function(e){t.origin=e},expression:"origin"}},[e("template",{slot:"prepend"},[t._v("起点")]),e("template",{slot:"append"},[e("el-button",{staticClass:"iconfont icon-zuobiao",nativeOn:{click:function(e){return t.selectPoint("origin")}}})],1)],2),e("el-input",{attrs:{placeholder:"点击右侧按钮选择终点"},model:{value:t.destination,callback:function(e){t.destination=e},expression:"destination"}},[e("template",{slot:"prepend"},[t._v("终点")]),e("template",{slot:"append"},[e("el-button",{staticClass:"iconfont icon-zuobiao",nativeOn:{click:function(e){return t.selectPoint("destination")}}})],1)],2)],1),e("div",{staticClass:"submit-btn"},[e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.planRoute}},[e("i",{staticClass:"iconfont icon-zuobiao"},[t._v("点击规划")])])],1)])]),e("div",{staticClass:"synchrone"},[e("span",{staticClass:"title"},[t._v("出行分级等时圈")]),e("div",{staticClass:"drow-synchrone"},[e("div",{staticClass:"choose-layer"},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择设施点"},model:{value:t.chooseLayer,callback:function(e){t.chooseLayer=e},expression:"chooseLayer"}},t._l(["公园","学校","商场","医院"],function(t,i){return e("el-option",{key:i,attrs:{label:t,value:t}})}),1),e("el-input",{attrs:{placeholder:"点击右侧按钮选择中心"},model:{value:t.centerPoint,callback:function(e){t.centerPoint=e},expression:"centerPoint"}},[e("template",{slot:"prepend"},[e("i",{staticClass:"iconfont icon-shizhongxin"})]),e("template",{slot:"append"},[e("el-button",{staticClass:"iconfont icon-zuobiao",nativeOn:{click:function(e){return t.selectPoint("centerPoint")}}})],1)],2)],1),e("div",{staticClass:"submit-btn"},[e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.drawSynchrone}},[e("i",{staticClass:"iconfont icon-huizhi"},[t._v("点击绘制")])])],1),e("div",{staticClass:"submit-btn",staticStyle:{"margin-top":"8px"}},[e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.clearSynchrone}},[e("i",{staticClass:"iconfont icon-qingchu"},[t._v("清除等时圈")])])],1)])])])]),t._m(0)])],1)},mt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"legend"},[e("div",{staticClass:"title"},[e("span",[t._v("设施点图例")])]),e("div",{staticClass:"icon"},[e("i",{staticClass:"iconfont icon-a-065_gongyuan park"},[t._v(" 公园 ")]),e("i",{staticClass:"iconfont icon-xuexiao1 school"},[t._v(" 学校 ")]),e("i",{staticClass:"iconfont icon-gouwu mall"},[t._v(" 商场 ")]),e("i",{staticClass:"iconfont icon-yiyuan hospital"},[t._v(" 医院 ")])])])}],ft=function(){var t=this,e=t._self._c;return e("div",{ref:"map",class:{"selecting-point":""!==t.selectMode},attrs:{id:"map"}})},gt=[],yt={name:"AnalysisIndex",data(){return{map:null,view:null,layer:{parks:null,malls:null,hospitals:null,schools:null,houses:null},driving:null,routes:{driving:null,transit:null,walking:null},markers:{start:null,end:null},overlays:[],routeInfos:[],isochronePolygons:[],isochroneCenter:null,timeThresholds:[300,600,900,1200,1800],thresholdColors:["#ff4d4f","#ffa940","#ffdb5c","#4caf50","#2196f3"],drivingInstance:null,currentFacilityType:"",isDrawingIsochrone:!1,facilityDataReady:!1}},props:{checkboxGroup:{type:Array,default:()=>[]},origin:{type:String,default:""},destination:{type:String,default:""},selectMode:{type:String,default:""},chooseLayer:{type:String,default:""},planningMethods:{type:Array,default:()=>["驾车"]}},mounted(){this.createAllLayers(),this.initMap()},beforeDestroy(){},watch:{checkboxGroup:{handler(){this.updateLayerVisibility()},deep:!0,immediate:!0},selectMode:{handler(t){this.map&&(""!==t?this.map.addEventListener("click",this.handleMapClick):this.map.removeEventListener("click",this.handleMapClick))},immediate:!0}},methods:{initMap(){this.map=new BMapGL.Map("map",{enableRotate:!0,enableTilt:!0});const t=new BMapGL.Point(106.5778767,29.5587398);this.map.centerAndZoom(t,15.5),this.map.enableScrollWheelZoom(),this.view=new mapvgl.View({map:this.map,events:{click:!0}}),this.routes.driving=new BMapGL.DrivingRoute(this.map,{renderOptions:{map:null},onSearchComplete:t=>{if(t&&t.getPlan(0)){const e=t.getPlan(0),i=e.getRoute(0),s=i.getPath(),a=new BMapGL.Polyline(s,{strokeColor:"#e74c3c",strokeWeight:6,strokeOpacity:.8});this.map.addOverlay(a),this.overlays.push(a);const o=e.getDistance(!0),n=e.getDuration(!0);this.addRouteInfo("驾车",o,n)}}}),this.routes.transit=new BMapGL.TransitRoute(this.map,{renderOptions:{map:null},onSearchComplete:t=>{if(t&&t.getNumPlans()>0){const e=t.getPlan(0);let i=[];for(let t=0;t<e.getNumLines();t++){const s=e.getLine(t);s.getPath&&(i=i.concat(s.getPath()))}if(i.length>0){const t=new BMapGL.Polyline(i,{strokeColor:"#3498db",strokeWeight:6,strokeOpacity:.8});this.map.addOverlay(t),this.overlays.push(t)}const s=e.getDistance(!0)||"未知",a=e.getDuration(!0)||"未知";this.addRouteInfo("公共交通",s,a)}}}),this.routes.walking=new BMapGL.WalkingRoute(this.map,{renderOptions:{map:null},onSearchComplete:t=>{if(t&&t.getPlan(0)){const e=t.getPlan(0),i=e.getRoute(0),s=i.getPath(),a=new BMapGL.Polyline(s,{strokeColor:"#27ae60",strokeWeight:6,strokeOpacity:.8});this.map.addOverlay(a),this.overlays.push(a);const o=e.getDistance(!0),n=e.getDuration(!0);this.addRouteInfo("步行",o,n)}}}),this.loadPOIS()},createAllLayers(){this.layer.parks=new mapvgl.PointLayer({size:10,color:"rgb(24,177,78)",blend:"lighter",style:"normal",enablePicked:!0,autoSelect:!0,riseTime:800,onClick:t=>{console.log(t)}}),this.layer.malls=new mapvgl.PointLayer({size:10,color:"rgb(241,157,0)",blend:"lighter",style:"normal",enablePicked:!0,autoSelect:!0,riseTime:800,onClick:t=>{console.log(t)}}),this.layer.hospitals=new mapvgl.PointLayer({size:10,color:"rgb(14,123,168)",blend:"lighter",style:"normal",enablePicked:!0,autoSelect:!0,riseTime:800,onClick:t=>{console.log(t)}}),this.layer.schools=new mapvgl.PointLayer({size:10,color:"rgb(220,45,7)",blend:"lighter",style:"normal",enablePicked:!0,autoSelect:!0,riseTime:800,onClick:t=>{console.log(t)}}),this.layer.houses=new mapvgl.PointLayer({size:10,color:"rgb(220,86,140)",blend:"lighter",style:"normal",enablePicked:!0,autoSelect:!0,riseTime:800,onClick:t=>{if(!t||void 0===t.dataIndex||-1===t.dataIndex)return;const{dataItem:e}=t;setTimeout(()=>{e.properties?.feature&&this.$emit("show-house-detail",e.properties.feature)},300)}}),this.view?.addLayer?.(this.layer.parks),this.view?.addLayer?.(this.layer.malls),this.view?.addLayer?.(this.layer.hospitals),this.view?.addLayer?.(this.layer.schools),this.view?.addLayer?.(this.layer.houses)},drawRoutes(t,e,i){if(!t||!e)return void this.$message.warning("请设置起点和终点");if(!i||0===i.length)return void this.$message.warning("请选择出行方式");this.clearAllRoutes();const[s,a]=t.split(",").map(Number),[o,n]=e.split(",").map(Number),l=new BMapGL.Point(a,s),r=new BMapGL.Point(n,o);i.forEach(t=>{"驾车"===t&&this.routes.driving.search(l,r),"公共交通"===t&&this.routes.transit.search(l,r),"步行"===t&&this.routes.walking.search(l,r)}),this.map.setViewport([l,r])},addRouteInfo(t,e,i){this.routeInfos.push({type:t,distance:e,duration:i}),this.$emit("route-info-update",this.routeInfos.slice())},clearAllRoutes(){this.overlays.forEach(t=>this.map.removeOverlay(t)),this.overlays=[],this.markers.start=null,this.markers.end=null,this.routeInfos=[],this.$emit("route-info-update",[]),Object.values(this.routes).forEach(t=>t?.clearResults?.())},async loadPOIS(){const[t,e,i,s,a]=await Promise.all([K.A.get("/data/POIS/chongqing_yuzhong_parks.json"),K.A.get("/data/POIS/chongqing_yuzhong_malls.json"),K.A.get("/data/POIS/chongqing_yuzhong_hospitals.json"),K.A.get("/data/POIS/chongqing_yuzhong_schools.json"),K.A.get("/data/new_anjuke_yuzhong.json")]),o=this.formatData2D(t.data),n=this.formatData2D(e.data),l=this.formatData2D(i.data),r=this.formatData2D(s.data),c=this.formatData2D(a.data);this.layer.parks.setData(o),this.layer.malls.setData(n),this.layer.hospitals.setData(l),this.layer.schools.setData(r),this.layer.houses.setData(c),this.facilityDataReady=!0,this.updateLayerVisibility(),this.$message.success("设施点数据加载完成")},formatData2D(t){return t.map(t=>({geometry:{type:"Point",coordinates:[t.longitude,t.latitude]},properties:{feature:t}}))},updateLayerVisibility(){if(!this.view||!this.checkboxGroup||!Array.isArray(this.checkboxGroup))return;const t={"公园":this.layer.parks,"学校":this.layer.schools,"商场":this.layer.malls,"医院":this.layer.hospitals};["公园","学校","商场","医院"].forEach(e=>{const i=t[e];if(!i)return;const s=this.checkboxGroup.includes(e),a=this.view.getAllLayers().includes(i);s&&!a?this.view.addLayer(i):!s&&a&&this.view.removeLayer(i)}),this.layer.houses&&!this.view.getAllLayers().includes(this.layer.houses)&&this.view.addLayer(this.layer.houses)},handleMapClick(t){const e=t.point.lng,i=t.point.lat,s=new BMapGL.Convertor,a=[new BMapGL.Point(e,i)];s.translate(a,6,5,t=>{if(0===t.status&&t.points&&t.points.length>0){const e=t.points[0],i=e.lng,s=e.lat,a=`${s.toFixed(6)},${i.toFixed(6)}`;"origin"===this.selectMode?this.$emit("update:origin",a):"destination"===this.selectMode?this.$emit("update:destination",a):"centerPoint"===this.selectMode&&this.$emit("update:centerPoint",a),this.$emit("update:selectMode","")}else console.error("坐标转换失败",t),this.$message.error("坐标转换失败，请重试")})},async runWithConcurrencyLimit(t,e=3){const i=[],s=[];for(const a of t){const t=a().then(e=>(s.splice(s.indexOf(t),1),e));i.push(t),s.push(t),s.length>=e&&await Promise.race(s)}return Promise.all(i)},drawIsochrone(t,e){const[i,s]=t.split(",").map(Number);this.isochroneCenter=new BMapGL.Point(s,i),this.currentFacilityType=e,this.calculateIsochrones()},clearIsochrones(){this.isochronePolygons.forEach(t=>this.map.removeOverlay(t)),this.isochronePolygons=[]},async calculateIsochrones(){if(!this.isDrawingIsochrone){this.isDrawingIsochrone=!0,this.$emit("isochrone-loading",!0);try{if(!this.isochroneCenter||!this.currentFacilityType)return void this.$message.warning("参数缺失，无法绘制等时圈");const t={"公园":this.layer.parks,"学校":this.layer.schools,"商场":this.layer.malls,"医院":this.layer.hospitals},e=t[this.currentFacilityType];if(!e||!e.getData?.()?.length)return void this.$message.warning("数据加载中，请稍后重试...");const i=e.getData(),s=i.map(t=>{const e=t.geometry?.coordinates?.[0],i=t.geometry?.coordinates?.[1];return"number"===typeof e&&"number"===typeof i?{lng:e,lat:i}:null}).filter(Boolean);if(s.length<3)return void this.$message.warning("有效设施点不足3个，无法生成等时圈");this.clearIsochrones(),this.drivingInstance=new BMapGL.DrivingRoute(this.map,{renderOptions:{autoViewport:!1}});const a=this.timeThresholds.map(()=>[]),o=s.map(t=>{const e=new BMapGL.Point(t.lng,t.lat);return async()=>{let t=null;for(let a=0;a<3;a++){if(t=await this.searchDrivingRoute(this.isochroneCenter,e),t&&t.getPlan(0))break;a<2&&await new Promise(t=>setTimeout(t,300*(a+1)))}if(!t||!t.getPlan(0))return null;const i=t.getPlan(0),s=i.getRoute(0);if(!s?.getPath?.()?.length)return null;const o=i.getDuration(!1)||999999;this.timeThresholds.forEach((t,i)=>{if(o<=t)a[i].push(e);else if(i>0&&o>this.timeThresholds[i-1]){const t=this.timeThresholds[i-1]/o,e=this.interpolateOnRoute(s,t,o);e&&a[i].push(e)}})}});await this.runWithConcurrencyLimit(o,3),a.reverse().forEach((t,e)=>{const i=a.length-1-e,s=t.filter(t=>t&&"number"===typeof t.lng&&"number"===typeof t.lat);if(s.length<3)return;const o=this.computeConvexHull(s);if(o.length<3)return;const n=new BMapGL.Polygon(o,{strokeColor:this.thresholdColors[i],fillColor:this.thresholdColors[i],fillOpacity:.15+.05*i,strokeWeight:3,strokeOpacity:.9});this.map.addOverlay(n),this.isochronePolygons.push(n)});const n=new BMapGL.Marker(this.isochroneCenter,{icon:new BMapGL.Icon('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 1024 1024"><path fill="%23ff4d4f" d="M512 64C334.336 64 192 206.336 192 384c0 275.456 320 576 320 576s320-300.544 320-576C832 206.336 689.664 64 512 64z"/></svg>',new BMapGL.Size(30,30))});this.map.addOverlay(n),this.isochronePolygons.push(n);const l=this.isochronePolygons.filter(t=>t instanceof BMapGL.Polygon).length;l>0?(this.$message.success(`等时圈绘制完成！共 ${l} 层`),this.$emit("isochrone-complete",l)):(this.$message.info("未生成有效等时圈，可能设施点太远或不可达"),this.$emit("isochrone-complete",0))}catch(t){console.error(t),this.$message.error("绘制等时圈失败，请重试")}finally{this.isDrawingIsochrone=!1,this.$emit("isochrone-loading",!1)}}},searchDrivingRoute(t,e){return new Promise(i=>{let s=!1;const a=t=>{s||(s=!0,0===this.drivingInstance.getStatus()?i(t):i(null))};this.drivingInstance.setSearchCompleteCallback(a),this.drivingInstance.search(t,e),setTimeout(()=>{s||(s=!0,i(null))},8e3)})},interpolateOnRoute(t,e,i){const s=t.getPath();if(!s||s.length<2)return null;const a=i*e;let o=0;for(let l=1;l<s.length;l++){const t=s[l-1],e=s[l],i=this.map.getDistance(t,e);if(i<=0)continue;const n=i/8.33;if(o+n>=a){const i=(a-o)/n;return new BMapGL.Point(t.lng+(e.lng-t.lng)*i,t.lat+(e.lat-t.lat)*i)}o+=n}const n=s[s.length-1];return n?new BMapGL.Point(n.lng,n.lat):null},computeConvexHull(t){const e=t.filter(t=>t&&"number"===typeof t.lng&&"number"===typeof t.lat);if(e.length<3)return e;let i=e.slice(),s=0;for(let n=1;n<i.length;n++)(i[n].lat<i[s].lat||i[n].lat===i[s].lat&&i[n].lng<i[s].lng)&&(s=n);const a=i[s];i.splice(s,1),i.sort((t,e)=>{const i=Math.atan2(t.lat-a.lat,t.lng-a.lng),s=Math.atan2(e.lat-a.lat,e.lng-a.lng);if(i!==s)return i-s;const o=(t.lng-a.lng)**2+(t.lat-a.lat)**2,n=(e.lng-a.lng)**2+(e.lat-a.lat)**2;return o-n}),i.unshift(a);const o=[i[0]];for(let n=1;n<i.length;n++){while(o.length>=2&&this.crossProduct(o[o.length-2],o[o.length-1],i[n])<=0)o.pop();o.push(i[n])}return o},crossProduct(t,e,i){return t&&e&&i?(e.lng-t.lng)*(i.lat-t.lat)-(e.lat-t.lat)*(i.lng-t.lng):0}}},vt=yt,bt=(0,p.A)(vt,ft,gt,!1,null,"2ac3b312",null),wt=bt.exports,Ct={name:"RealsceneAnalysis",components:{HouseDetail:N,WishList:rt,AnalysisIndex:wt},data(){return{isWishListVisible:!1,checkboxGroup:["公园"],planningMethods:["驾车"],origin:"",destination:"",centerPoint:"",chooseLayer:"",selectMode:"",floatingDetail:{visible:!1,house:null},routeInfos:[],showRoutePanel:!1,showIsochroneTip:!1,showIsochroneLegend:!1,isochroneLayersCount:0,thresholdColors:["#ff4d4f","#ffa940","#ffdb5c","#4caf50","#2196f3"]}},mounted(){},watch:{chooseLayer(t){t&&!this.checkboxGroup.includes(t)&&(this.checkboxGroup=[...this.checkboxGroup,t],this.$notify.success({title:"加载完成",message:`已加载 ${t} 图层，用于等时圈分析`,duration:2e3,position:"top-right",offset:80}))}},computed:{},methods:{toggleWishList(){this.isWishListVisible=!this.isWishListVisible},handleLocate(t){const e=new BMapGL.Point(t.longitude,t.latitude);this.$refs.analysisIndex.map.centerAndZoom(e,17),this.isDetailVisible=!1,this.isWishListVisible=!1},onShowHouseDetail(t){void 0!==t&&null!==t&&(this.floatingDetail.visible=!1,setTimeout(()=>{this.floatingDetail={visible:!0,house:t},this.handleLocate(t)},100))},floatCardAddToWishList(){null===this.floatingDetail.house||this.floatingDetail.house.length<1||(this.$store.commit("addToWishList",this.floatingDetail.house),this.$notify.success({title:"添加成功",message:"已加入心愿单",duration:2e3,position:"top-right",offset:80}),this.floatingDetail.visible=!1)},closeFloatingOnOutside(t){t.target.closest(".floating-detail-card")||t.target.closest(".wish-icon")||t.target.closest(".wish-list")||(this.floatingDetail.visible=!1,this.isWishListVisible=!1)},selectPoint(t){this.selectMode=t},planRoute(){this.$refs.analysisIndex&&"function"===typeof this.$refs.analysisIndex.drawRoutes?this.$refs.analysisIndex.drawRoutes(this.origin,this.destination,this.planningMethods):this.$notify.error({title:"警告",message:"地图未初始化",duration:2e3,position:"top-right",offset:80})},onRouteInfoUpdate(t){this.routeInfos=t,this.showRoutePanel=t.length>0},drawSynchrone(){this.chooseLayer?this.centerPoint?(this.$refs.customIsochroneTip&&this.$refs.customIsochroneTip.show(),this.$refs.analysisIndex.drawIsochrone(this.centerPoint,this.chooseLayer)):this.$notify.warning({title:"提示",message:"请先选择中心点",duration:2e3,position:"top-right",offset:80}):this.$notify.warning({title:"提示",message:"请选择设施点类型",duration:2e3,position:"top-right",offset:80})},clearSynchrone(){this.$refs.analysisIndex&&"function"===typeof this.$refs.analysisIndex.clearIsochrones&&(this.$refs.analysisIndex.clearIsochrones(),this.$notify.info({title:"提示",message:"等时圈已清除",duration:2e3,position:"top-right",offset:80}),this.showIsochroneLegend=!1)},onIsochroneComplete(t){this.isochroneLayersCount=t,this.showIsochroneLegend=!0,this.showIsochroneTip=!1}}},_t=Ct,kt=(0,p.A)(_t,dt,mt,!1,null,"46bf2b6b",null),Dt=kt.exports,xt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"surround-facility",on:{click:t.closeFloatingOnOutside}},[e("HeatPoint",{ref:"heatPoint",staticClass:"map-layer",attrs:{"heat-type":t.activeHeatTypeClass},on:{"show-house-detail":t.onShowHouseDetail}}),e("el-button",{staticClass:"wish-icon",attrs:{circle:""},on:{click:t.toggleWishList}},[e("i",{staticClass:"el-icon-star-off",staticStyle:{"font-size":"24px",color:"#ffd04b"}})]),e("transition",{attrs:{name:"fade-scale"}},[t.floatingDetail.visible?e("div",{staticClass:"floating-detail-card",on:{click:function(t){t.stopPropagation()}}},[e("HouseDetail",{attrs:{feature:t.floatingDetail.house}}),e("div",{staticClass:"float-wish-icon",on:{click:t.floatCardAddToWishList}},[e("i",{staticClass:"el-icon-star-off",staticStyle:{"font-size":"24px",color:"#ffd04b"}})])],1):t._e()]),t.isWishListVisible?e("wish-list",{on:{close:function(e){t.isWishListVisible=!1},locate:t.handleLocate}}):t._e(),e("div",{staticClass:"components"},[e("h3",{staticClass:"title"},[t._v("热力图切换")]),e("div",{staticClass:"tools"},[e("div",{staticClass:"comprehensive"},[e("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning",plain:"comprehensive"!==t.activeHeatTypeClass},on:{click:function(e){return t.switchHeatMap("comprehensive")}}},[t._v(" 综合便利度热力图 ")]),t._m(0)],1),e("div",{staticClass:"personalization"},[e("h3",[t._v("个性化需求匹配热力图")]),e("div",{staticClass:"button-group"},[e("el-button",{staticClass:"work",attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("work")}}},[t._v("上班族模式")]),e("el-button",{staticClass:"home",attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("home")}}},[t._v("家庭模式")]),e("el-button",{staticClass:"young",attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("young")}}},[t._v("年轻人模式")]),e("el-button",{staticClass:"elder",attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("elder")}}},[t._v("养老模式")])],1)]),e("div",{staticClass:"day-parting"},[e("h3",[t._v("分时段活力热力图")]),e("div",{staticClass:"button-group"},[e("el-button",{staticClass:"daylight",attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("daylight")}}},[t._v("工作日白天")]),e("el-button",{staticClass:"daynight",attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("daynight")}}},[t._v("工作日晚间")]),e("el-button",{staticClass:"weekend",attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("weekend")}}},[t._v("周末全天")]),e("el-button",{staticClass:"holiday",attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("holiday")}}},[t._v("节假日")])],1)]),e("div",{staticClass:"association"},[e("h3",[t._v("房价-便利度关联热力图")]),e("div",{staticClass:"button-group"},[e("el-button",{staticClass:"convenience",staticStyle:{width:"100%"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("convenience")}}},[t._v(" 高便利度区域 ")]),e("div",{staticClass:"description-line"},[t._v("高租金区域")]),e("el-button",{staticClass:"cost-performance",staticStyle:{width:"100%"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("cost-performance")}}},[t._v(" 性价比区域 ")]),e("div",{staticClass:"description-line"},[t._v("中等便利度但租金较低区域")]),e("el-button",{staticClass:"potential",staticStyle:{width:"100%"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.switchHeatMap("potential")}}},[t._v(" 潜力区域 ")]),e("div",{staticClass:"description-line"},[t._v("便利度中等但租金洼地区域")])],1)])])])],1)},Pt=[function(){var t=this,e=t._self._c;return e("ul",{staticClass:"description"},[e("li",[t._v("交通")]),e("li",[t._v("医疗")]),e("li",[t._v("教育")]),e("li",[t._v("商业")]),e("li",[t._v("休闲")])])}],Lt=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",height:"100%"}})},St=[],Mt={name:"HeatPoint",props:{heatType:{type:String,default:"comprehensive"}},data(){return{map:null,view:null,comprehensiveLayer:null,rawData:{house:[],subway:[],bus:[],hospital:[],park:[],school:[]}}},watch:{heatType(t){this.updateHeatMap(t)}},mounted(){this.initMap()},beforeDestroy(){this.map&&this.map.destroy(),this.view&&this.view.destroy()},methods:{async initMap(){BMapGL.coordType="bd09",this.map=new BMapGL.Map(this.$el,{enableRotate:!0,enableTilt:!0});const t=new BMapGL.Point(106.5778767,29.5587398);this.map.centerAndZoom(t,15.5),this.map.setTilt(45),this.map.enableScrollWheelZoom(),this.view=new mapvgl.View({effects:[new mapvgl.BloomEffect({threshold:0,blurSize:.2})],map:this.map,events:{click:!0}});const[e,i,s,a,o,n]=await Promise.all([K.A.get("/data/new_anjuke_yuzhong.json"),K.A.get("/data/POIS/chongqing_yuzhong_subway_stations.json"),K.A.get("data/POIS/chongqing_yuzhong_bus_stations.json"),K.A.get("data/POIS/chongqing_yuzhong_hospitals.json"),K.A.get("data/POIS/chongqing_yuzhong_parks.json"),K.A.get("data/POIS/chongqing_yuzhong_schools.json")]);this.rawData.house=this.formatData2D(e.data),this.rawData.subway=this.formatData2D(i.data),this.rawData.bus=this.formatData2D(s.data),this.rawData.hospital=this.formatData2D(a.data),this.rawData.park=this.formatData2D(o.data),this.rawData.school=this.formatData2D(n.data),this.comprehensiveLayer=new mapvgl.HeatGridLayer({gridSize:60,max:200,min:0,maxHeight:1e3,minHeight:200,riseTime:1500,altitude:0,opacity:.8,gradient:this.getGradient("comprehensive")}),this.view.addLayer(this.comprehensiveLayer),this.updateHeatMap(this.heatType),await this.initCluster()},async initCluster(){const t=await K.A.get("/data/new_anjuke_yuzhong.json"),e=t.data,i=this.formatData2D(e);this.clusterlayer=new mapvgl.ClusterLayer({color:({properties:t})=>t.color,showText:!0,minSize:30,maxSize:60,clusterRadius:100,maxZoom:16,minZoom:14,gradient:{0:"rgb(218,79,131)",1:"rgba(191,7,82,1)"},textOptions:{fontSize:12,fontFamily:"Microsoft Yahei",margin:[5,5],color:"white",format:function(t){return t}},shape:"circle",enablePicked:!0,altitude:t=>{const e=t.children?t.children.length:1;return 400+10*e},onClick:t=>{if(!t||void 0===t.dataIndex||-1===t.dataIndex)return;const{dataItem:e}=t,i=this.map,s=e.children&&Array.isArray(e.children)&&e.children.length>0;if(s){const[t,s]=e.geometry.coordinates,a=new BMapGL.Point(t,s),o=Math.min(i.getZoom()+3,20);return i.centerAndZoom(a,o),void setTimeout(()=>{const t=e.children[0];t?.properties?.feature&&this.$emit("show-house-detail",e.properties.feature)},450)}e.properties?.feature&&this.$emit("show-house-detail",e.properties.feature)}}),this.view.addLayer(this.clusterlayer),this.clusterlayer.setData(i)},multiplyPoints(t,e=1){if(!t||e<=0)return[];const i=[];for(let s=0;s<e;s++)i.push(...t);return i},getCombinedData(t){let e=[];switch(t){case"comprehensive":e=[...this.multiplyPoints(this.rawData.subway,7),...this.multiplyPoints(this.rawData.hospital,6),...this.multiplyPoints(this.rawData.school,6),...this.multiplyPoints(this.rawData.bus,5),...this.multiplyPoints(this.rawData.park,4)];break;case"work":e=[...this.multiplyPoints(this.rawData.subway,18),...this.multiplyPoints(this.rawData.bus,4)];break;case"home":e=[...this.multiplyPoints(this.rawData.hospital,12),...this.multiplyPoints(this.rawData.school,12),...this.multiplyPoints(this.rawData.park,8),...this.multiplyPoints(this.rawData.bus,5)];break;case"young":e=[...this.multiplyPoints(this.rawData.bus,12),...this.multiplyPoints(this.rawData.park,12),...this.multiplyPoints(this.rawData.subway,6)];break;case"elder":e=[...this.multiplyPoints(this.rawData.hospital,15),...this.multiplyPoints(this.rawData.park,12),...this.multiplyPoints(this.rawData.bus,8),...this.multiplyPoints(this.rawData.school,2),...this.multiplyPoints(this.rawData.subway,2)];break;case"daylight":e=[...this.multiplyPoints(this.rawData.subway,12),...this.multiplyPoints(this.rawData.bus,10),...this.multiplyPoints(this.rawData.school,8)];break;case"daynight":e=[...this.multiplyPoints(this.rawData.park,12),...this.multiplyPoints(this.rawData.hospital,10),...this.multiplyPoints(this.rawData.bus,10)];break;case"weekend":e=[...this.multiplyPoints(this.rawData.park,15),...this.multiplyPoints(this.rawData.bus,10),...this.multiplyPoints(this.rawData.subway,8),...this.multiplyPoints(this.rawData.hospital,4)];break;case"holiday":e=[...this.multiplyPoints(this.rawData.park,18),...this.multiplyPoints(this.rawData.subway,12),...this.multiplyPoints(this.rawData.bus,12)];break;case"convenience":e=[...this.multiplyPoints(this.rawData.subway,12),...this.multiplyPoints(this.rawData.bus,10),...this.multiplyPoints(this.rawData.hospital,12),...this.multiplyPoints(this.rawData.school,12),...this.multiplyPoints(this.rawData.park,10)];break;case"cost-performance":e=[...this.multiplyPoints(this.rawData.bus,14),...this.multiplyPoints(this.rawData.park,12),...this.multiplyPoints(this.rawData.school,10),...this.multiplyPoints(this.rawData.hospital,6),...this.multiplyPoints(this.rawData.subway,3)];break;case"potential":e=[...this.multiplyPoints(this.rawData.subway,16),...this.multiplyPoints(this.rawData.school,10),...this.multiplyPoints(this.rawData.park,10),...this.multiplyPoints(this.rawData.bus,6)];break;default:e=this.getCombinedData("comprehensive")}return e},getGradient(t){const e={comprehensive:{0:"rgb(32, 178, 170)",1:"rgb(0, 100, 100)"},work:{0:"rgb(255, 90, 30)",1:"rgb(165, 20, 130)"},home:{0:"rgb(30, 180, 255)",1:"rgb(40, 40, 160)"},young:{0:"rgb(255, 245, 180)",1:"rgb(255, 120, 20)"},elder:{0:"rgb(100, 220, 100)",1:"rgb(0, 120, 0)"},daylight:{0:"rgb(255, 240, 100)",1:"rgb(200, 150, 0)"},daynight:{0:"rgb(80, 80, 220)",1:"rgb(40, 40, 140)"},weekend:{0:"rgb(255, 160, 80)",1:"rgb(200, 80, 0)"},holiday:{0:"rgb(255, 80, 80)",1:"rgb(180, 0, 0)"},convenience:{0:"rgb(255, 220, 100)",1:"rgb(200, 140, 0)"},"cost-performance":{0:"rgb(150, 255, 80)",1:"rgb(60, 180, 0)"},potential:{0:"rgb(180, 120, 255)",1:"rgb(100, 40, 180)"}};return e[t]||e.comprehensive},updateHeatMap(t){if(!this.comprehensiveLayer)return;const e=this.getCombinedData(t);this.comprehensiveLayer.setData(e);const i=e.length>0?Math.ceil(e.length/40):100;this.comprehensiveLayer.setOptions({max:i<50?100:i,gradient:this.getGradient(t)})},formatData2D(t){return t.map(t=>({geometry:{type:"Point",coordinates:[t.longitude,t.latitude]},properties:{id:t.uid||t.id||t._id||Date.now(),feature:t}}))}}},$t=Mt,At=(0,p.A)($t,Lt,St,!1,null,"ef4e5cea",null),Ht=At.exports,zt={name:"ThermalComparison",components:{HouseDetail:N,WishList:rt,HeatPoint:Ht},data(){return{isWishListVisible:!1,activeHeatTypeClass:"comprehensive",floatingDetail:{visible:!1,house:null}}},watch:{},methods:{toggleWishList(){this.isWishListVisible=!this.isWishListVisible},handleLocate(t){if(!this.$refs.heatPoint||!this.$refs.heatPoint.map)return void console.warn("！！！地图未初始化！！！");const e=new BMapGL.Point(t.longitude,t.latitude);this.$refs.heatPoint.map.centerAndZoom(e,20),this.isDetailVisible=!1,this.isWishListVisible=!1},switchHeatMap(t){this.activeHeatTypeClass=t},onShowHouseDetail(t){void 0!==t&&null!==t&&(this.floatingDetail.visible=!1,setTimeout(()=>{this.floatingDetail={visible:!0,house:t},this.handleLocate(t)},100))},floatCardAddToWishList(){null===this.floatingDetail.house||this.floatingDetail.house.length<1||(this.$store.commit("addToWishList",this.floatingDetail.house),this.$notify.success({title:"提示",message:"已加入心愿单",duration:2e3,position:"top-right",offset:80}),this.floatingDetail.visible=!1)},closeFloatingOnOutside(t){t.target.closest(".floating-detail-card")||t.target.closest(".wish-icon")||t.target.closest(".wish-list")||(this.floatingDetail.visible=!1)}}},Tt=zt,It=(0,p.A)(Tt,xt,Pt,!1,null,"44d7cdd8",null),Ot=It.exports,Wt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"community-vitality"},[e("el-tabs",{staticClass:"main-tabs",attrs:{type:"card"},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[e("el-tab-pane",{attrs:{label:"房源广场",name:"houseList"}},[e("div",{staticClass:"house-list"},[e("el-input",{staticClass:"search-input",attrs:{placeholder:"搜索房源..."}}),this.houseDetail.length>0?e("div",{staticClass:"main-content"},t._l(this.houseDetail,function(t,i){return e("HouseDetail",{key:i,attrs:{feature:t}})}),1):t._e()],1)]),e("el-tab-pane",{attrs:{label:"交流帖子",name:"posts"}},[e("div",{staticClass:"posts-section"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.showPostDialog=!0}}},[t._v("发布帖子")]),e("div",{staticClass:"posts-list"},t._l(5,function(i){return e("el-card",{key:i,staticClass:"post-card"},[e("div",{staticClass:"post-title"},[t._v("示例帖子标题 "+t._s(i))]),e("div",{staticClass:"post-content"},[t._v("帖子内容占位... 用户讨论租房经验、求租等。")]),e("div",{staticClass:"post-actions"},[e("el-button",{attrs:{size:"mini"}},[t._v("点赞")]),e("el-button",{attrs:{size:"mini"}},[t._v("回复")])],1)])}),1)],1),e("el-dialog",{attrs:{title:"发布帖子"},model:{value:t.showPostDialog,callback:function(e){t.showPostDialog=e},expression:"showPostDialog"}},[e("el-form",[e("el-input",{attrs:{placeholder:"帖子标题"}}),e("el-input",{attrs:{type:"textarea",placeholder:"帖子内容（支持房源链接、图片等）",rows:"5"}}),e("el-tag",[t._v("标签占位")])],1),e("el-button",{attrs:{type:"primary"},on:{click:t.submitPost}},[t._v("提交")])],1)],1),e("el-tab-pane",{attrs:{label:"我的账号",name:"account"}},[e("div",{staticClass:"account-section"},[e("el-card",{staticClass:"user-info-card"},[e("h3",[t._v("基本信息")]),e("p",[t._v("用户名: "+t._s(t.userInfo.name))]),e("p",[t._v("注册时间: 占位日期")]),e("el-button",{attrs:{size:"small"}},[t._v("编辑资料")])],1),e("el-card",{staticClass:"user-activity"},[e("h3",[t._v("我的发帖")]),e("ul",t._l(3,function(i){return e("li",{key:i},[t._v("发帖占位 "+t._s(i))])}),0)]),e("el-card",{staticClass:"user-activity"},[e("h3",[t._v("我的评论")]),e("ul",t._l(3,function(i){return e("li",{key:i},[t._v("评论占位 "+t._s(i))])}),0)]),e("el-card",{staticClass:"user-activity"},[e("h3",[t._v("点赞记录")]),e("ul",t._l(3,function(i){return e("li",{key:i},[t._v("点赞占位 "+t._s(i))])}),0)]),e("el-card",{staticClass:"user-activity"},[e("h3",[t._v("收藏房源")]),e("ul",t._l(3,function(i){return e("li",{key:i},[t._v("收藏房源占位 "+t._s(i))])}),0)])],1)])],1),e("el-dialog",{attrs:{title:t.selectedHouse?t.selectedHouse.title+" 评论区":"",width:"60%"},model:{value:t.selectedHouse,callback:function(e){t.selectedHouse=e},expression:"selectedHouse"}},[e("div",{staticClass:"comment-section"},[e("el-card",{staticClass:"publisher-self"},[e("h4",[t._v("发布者自述")]),e("p",[t._v("自述内容占位：房源优点、注意事项等。")])]),e("el-card",{staticClass:"user-comments"},[e("h4",[t._v("租客评论")]),t._l(4,function(i){return e("div",{key:i,staticClass:"comment-item"},[e("p",[t._v("评论内容占位 "+t._s(i))]),e("el-rate",{attrs:{disabled:"",value:3.5}}),e("el-button",{attrs:{size:"mini"}},[t._v("回复")])],1)}),e("el-input",{attrs:{type:"textarea",placeholder:"发布你的评论...",rows:"3"}}),e("el-button",{attrs:{type:"primary"},on:{click:t.submitComment}},[t._v("提交评论")])],2)],1)])],1)},Gt=[],Et={name:"ExchangeSquare",components:{HouseDetail:N},data(){return{activeTab:"houseList",houseList:[],selectedHouse:null,showPostDialog:!1,userInfo:{}}},computed:{...(0,f.aH)(["houseDetail"])},mounted(){this.userInfo={name:"用户名",posts:[],comments:[],likes:[],favorites:[]}},methods:{openCommentDialog(t){this.selectedHouse=t},submitComment(){this.$notify.success({title:"提示",message:"评论提交成功",duration:2e3,position:"top-right",offset:80})},submitPost(){this.$notify.success({title:"提示",message:"帖子发布成功",duration:2e3,position:"top-right",offset:80}),this.showPostDialog=!1}}},Bt=Et,Rt=(0,p.A)(Bt,Wt,Gt,!1,null,"4f117b22",null),Vt=Rt.exports,Ft=function(){var t=this,e=t._self._c;return e("div",{staticClass:"property-comparison"},[e("div",{staticClass:"selection-area"},[e("el-select",{staticStyle:{flex:"1"},attrs:{multiple:"",filterable:"",clearable:"",placeholder:"从心愿单选择房源进行对比（可多选）"},model:{value:t.selectedHouses,callback:function(e){t.selectedHouses=e},expression:"selectedHouses"}},t._l(t.houseOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),e("el-button",{attrs:{type:"primary"},on:{click:t.addToCompare}},[t._v("添加对比")]),e("el-button",{on:{click:t.clearCompare}},[t._v("清除所有")])],1),e("el-tabs",{staticClass:"compare-tabs",model:{value:t.viewTab,callback:function(e){t.viewTab=e},expression:"viewTab"}},[e("el-tab-pane",{attrs:{label:"表格对比",name:"table"}},[t.compareData.length?e("el-table",{staticStyle:{width:"100%","margin-top":"10px"},attrs:{data:t.compareData,border:"",stripe:""}},[e("el-table-column",{attrs:{prop:"title",label:"房源标题",width:"300",fixed:""}}),e("el-table-column",{attrs:{prop:"price",label:"租金",width:"120"}}),e("el-table-column",{attrs:{prop:"layout",label:"户型",width:"120"}}),e("el-table-column",{attrs:{prop:"area",label:"面积",width:"100"}}),e("el-table-column",{attrs:{prop:"floor",label:"楼层",width:"140"}}),e("el-table-column",{attrs:{prop:"building",label:"楼盘",width:"180"}}),e("el-table-column",{attrs:{prop:"address",label:"地址","min-width":"220"}}),e("el-table-column",{attrs:{prop:"tag",label:"标签",width:"100"}}),e("el-table-column",{attrs:{label:"操作",width:"100",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.removeItem(i.$index)}}},[t._v(" 移除 ")])]}}],null,!1,2029952155)})],1):e("el-empty",{attrs:{description:"暂无对比房源，请从上方选择添加"}})],1),e("el-tab-pane",{attrs:{label:"卡片对比",name:"card"}},[t.compareData.length?e("div",{staticClass:"card-view"},t._l(t.compareData,function(i,s){return e("el-card",{key:i.id,staticClass:"compare-card"},[e("div",{staticClass:"card-header"},[i.pic_link?e("img",{staticClass:"house-img",attrs:{src:i.pic_link,alt:"房源图片"}}):t._e(),i.tag?e("div",{staticClass:"tag"},[t._v(t._s(i.tag))]):t._e()]),e("h3",[t._v(t._s(i.title))]),e("p",[e("strong",[t._v("租金：")]),t._v(t._s(i.price))]),e("p",[e("strong",[t._v("户型：")]),t._v(t._s(i.layout))]),e("p",[e("strong",[t._v("面积：")]),t._v(t._s(i.area))]),e("p",[e("strong",[t._v("楼层：")]),t._v(t._s(i.floor))]),e("p",[e("strong",[t._v("楼盘：")]),t._v(t._s(i.building))]),e("p",[e("strong",[t._v("地址：")]),t._v(t._s(i.address))]),e("p",[e("strong",[t._v("描述：")]),t._v(t._s(i.description))]),e("el-button",{staticStyle:{"margin-top":"10px"},attrs:{size:"small",type:"danger"},on:{click:function(e){return t.removeItem(s)}}},[t._v(" 移除对比 ")])],1)}),1):e("el-empty",{attrs:{description:"暂无对比房源"}})],1),e("el-tab-pane",{attrs:{label:"图表对比",name:"chart"}},[0===t.compareData.length?e("div",{staticClass:"chart-wrapper"},[e("el-empty",{staticStyle:{padding:"80px 0"},attrs:{description:"暂无对比房源","image-size":200}},[e("p",{staticStyle:{color:"#999","margin-top":"20px"}},[t._v(" 请从上方「心愿单」中选择房源添加到对比后查看图表分析 ")])])],1):e("div",{staticClass:"chart-wrapper"},[e("el-row",{staticStyle:{margin:"-10px"},attrs:{gutter:20}},[e("el-col",{staticStyle:{"margin-bottom":"20px"},attrs:{span:24,lg:12}},[e("el-card",{staticClass:"chart-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"card-title",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("性价比分析（面积 vs 租金）")])]),e("div",{ref:"scatterChart",staticClass:"echart"})])],1),e("el-col",{staticStyle:{"margin-bottom":"20px"},attrs:{span:24,lg:12}},[e("el-card",{staticClass:"chart-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"card-title",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("综合能力雷达图")])]),e("div",{ref:"radarChart",staticClass:"echart"}),e("div",{staticStyle:{padding:"12px 16px",color:"#666","font-size":"13px","line-height":"1.6",background:"#f9f9f9","border-radius":"8px"}},[t._v(" 评分规则：性价比=100-租金/100，面积得分=实际面积（封顶100），楼层舒适中低楼层最高，交通便利含“地铁”关键词更高 ")])])],1),e("el-col",{attrs:{span:24}},[e("el-card",{staticClass:"chart-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"card-title",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("租金与面积并排对比")])]),e("div",{ref:"barChart",staticClass:"echart",staticStyle:{height:"500px"}})])],1)],1)],1)])],1),t.compareData.length?e("div",{staticClass:"actions"},[e("el-button",{attrs:{type:"primary"},on:{click:t.exportReport}},[t._v("导出对比报告")]),e("el-button",{on:{click:t.saveCompare}},[t._v("保存对比方案")])],1):t._e()],1)},jt=[],Nt=(i(116),{name:"PropertyComparison",data(){return{selectedHouses:[],compareData:[],viewTab:"table",charts:[]}},mounted(){this.$nextTick(()=>{0===this.compareData.length&&this.wishList.length>0&&(this.selectedHouses=this.wishList.map(t=>t.id),this.addToCompare(!0),this.viewTab="chart",this.$notify.success({title:"自动加载完成",message:`已将 ${this.wishList.length} 个心愿单房源添加到对比`,duration:2e3,position:"top-right",offset:80})),this.compareData.length>0&&this.initAllCharts()})},beforeDestroy(){this.clearCharts()},watch:{compareData:{handler(t){t.length>0?this.$nextTick(()=>{this.clearCharts(),this.initAllCharts()}):this.clearCharts()},deep:!0},viewTab(t){"chart"===t&&this.$nextTick(()=>{this.charts.forEach(t=>t&&t.resize())})},$route(t,e){("PropertyComparison"===t.name||t.path.includes("comparison"))&&this.$nextTick(()=>{setTimeout(()=>{this.charts.forEach(t=>t&&t.resize())},100)})}},computed:{...(0,f.aH)(["wishList"]),houseOptions(){return this.wishList.map(t=>({value:t.id,label:t.title||`房源 ${t.id}`}))}},methods:{addToCompare(t=!1){if(0===this.selectedHouses.length)return void this.$notify.warning({title:"加载提示",message:"请先选择要对比的房源",duration:2e3,position:"top-right",offset:80});let e=0;this.selectedHouses.forEach(t=>{const i=this.compareData.some(e=>e.id===t);if(i)return;const s=this.wishList.find(e=>e.id===t);if(s){const t=s.room||"",i=t.split("|"),a=i[0]?i[0].trim():"未知户型",o=i[1]?i[1].trim():"未知面积",n=i[2]?i[2].trim():"";this.compareData.push({id:s.id,title:s.title||"未知房源",price:s.price?`${s.price} ${s.unit||"元/月"}`:"未知价格",layout:a,area:o,floor:n||"未知楼层",building:s.building||"未知楼盘",address:s.address||"未知位置",description:s.description||"",contact:s.contact||"",tag:s.tag||"",pic_link:s.pic_link||""}),e++}}),t||(e>0?this.$notify.success({title:"添加成功",message:`成功添加 ${e} 个房源到对比`,duration:2e3,position:"top-right",offset:80}):this.$notify.info({title:"房源已添加",message:"选中的房源已全部在对比列表中",duration:2e3,position:"top-right",offset:80})),0===e&&this.$notify.info({title:"房源已添加",message:"选中的房源已全部在对比列表中",duration:2e3,position:"top-right",offset:80}),this.selectedHouses=[]},removeItem(t){this.compareData.splice(t,1),this.$notify.info({title:"移除房源",message:"已移除该房源",duration:2e3,position:"top-right",offset:80})},clearCompare(){this.compareData=[],this.selectedHouses=[],this.$notify.info({title:"清除完成",message:"已清除所有对比房源",duration:2e3,position:"top-right",offset:80})},exportReport(){this.$message.info("导出 PDF/Excel 功能开发中...")},saveCompare(){this.$message.info("保存对比方案功能开发中...")},clearCharts(){this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.charts.forEach(t=>t&&t.dispose&&t.dispose()),this.charts=[]},initAllCharts(){if("undefined"===typeof echarts)return console.warn("ECharts 未加载完成，500ms 后重试..."),void setTimeout(()=>this.initAllCharts(),500);this.clearCharts(),this.initScatterChart(),this.initRadarChart(),this.initBarChart(),this.resizeHandler=()=>{this.charts.forEach(t=>t&&t.resize())},window.removeEventListener("resize",this.resizeHandler),window.addEventListener("resize",this.resizeHandler)},extractArea(t){const e=t.match(/[\d.]+/);return e?parseFloat(e[0]):0},extractPrice(t){const e=t.match(/[\d,]+/);return e?parseFloat(e[0].replace(/,/g,"")):0},initScatterChart(){const t=this.$refs.scatterChart;if(!t||0===this.compareData.length)return;const e=echarts.init(t);this.charts.push(e);const i=this.compareData.map(t=>this.extractPrice(t.price)),s=this.compareData.map(t=>this.extractArea(t.area)),a=Math.max(...i)||1e3,o=Math.max(...s)||50,n=1e3*Math.ceil((a+1e3)/1e3),l=20*Math.ceil((o+10)/20),r=this.compareData.map(t=>{const e=this.extractArea(t.area),i=this.extractPrice(t.price),s=e>0?(i/e).toFixed(1):"0";return{name:t.title,value:[e,i],unitPrice:s,itemStyle:{color:i<4e3?"#67c23a":i<7e3?"#e6a23c":"#f56c6c",borderColor:"#fff",borderWidth:3,shadowBlur:10,shadowColor:"rgba(0,0,0,0.3)"}}}),c={title:{text:"性价比分析（右下角越划算）",left:"center",top:10,textStyle:{fontSize:17,fontWeight:"bold"}},tooltip:{trigger:"item",backgroundColor:"rgba(0,0,0,0.85)",borderWidth:0,padding:[10,15],textStyle:{color:"#fff",fontSize:14},position:function(t,e,i,s,a){const o=t[0],n=a.viewSize[0],l=260;return[Math.min(o+10,n-l-10),t[1]-150]},formatter:t=>{const e=t.data;return`\n          <div style="line-height:1.6">\n            <strong style="font-size:15px">${e.name}</strong><br/>\n            面积：<strong>${e.value[0]} ㎡</strong><br/>\n            月租：<strong style="color:#f56c6c">${e.value[1]} 元</strong><br/>\n            单价：<strong style="color:#e6a23c">${e.unitPrice} 元/㎡</strong>\n          </div>\n        `}},grid:{top:80,left:70,right:70,bottom:70},xAxis:{name:"建筑面积（㎡）",type:"value",min:0,max:l,nameLocation:"middle",nameGap:30,nameTextStyle:{fontWeight:"bold"},axisLabel:{fontSize:12}},yAxis:{name:"月租金（元）",type:"value",min:0,max:n,nameLocation:"middle",nameGap:50,nameTextStyle:{fontWeight:"bold"},axisLabel:{fontSize:12}},series:[{type:"scatter",data:r,symbolSize:24,emphasis:{scale:1.8}},{name:"80元/㎡参考线",type:"line",data:[[0,0],[l,80*l]],symbol:"none",lineStyle:{color:"#e74c3c",width:2.5,type:"dashed"},tooltip:{show:!1},markLine:{silent:!1,label:{show:!0,position:"end",formatter:"80元/㎡ 性价比线"},lineStyle:{color:"#e74c3c",type:"dashed",width:2}}}]};e.setOption(c)},initRadarChart(){const t=this.$refs.radarChart;if(!t||0===this.compareData.length)return;const e=echarts.init(t);this.charts.push(e);const i=[{name:"性价比",max:100},{name:"面积得分",max:100},{name:"楼层舒适",max:100},{name:"交通便利",max:100},{name:"装修程度",max:100}],s=this.compareData.map(t=>{const e=this.extractArea(t.area),i=this.extractPrice(t.price),s=Math.min(100,e),a=Math.max(20,100-i/100),o=/中楼层|低楼层/.test(t.floor)?95:/高楼层/.test(t.floor)?70:50,n=/地铁|公交|交通便利/.test(t.address+t.tag)?95:65,l=/精装|新装修|豪装|硬装/.test(t.description+t.tag)?95:65;return{name:t.title.length>7?t.title.slice(0,7)+"…":t.title,value:[a,s,o,n,l].map(Math.round)}}),a={title:{text:"房源综合能力雷达图",left:"center",top:8,textStyle:{fontSize:17,fontWeight:"bold"}},tooltip:{trigger:"item",formatter:t=>`<strong>${t.name}</strong><br/>\n                性价比：${t.value[0]}（租金越低越好）<br/>\n                面积得分：${t.value[1]}（面积越大越好）<br/>\n                楼层舒适：${t.value[2]}（中低楼层更佳）<br/>\n                交通便利：${t.value[3]}（近地铁更高）<br/>\n                装修程度：${t.value[4]}（精装更高）`},radar:{indicator:i,radius:"62%",name:{textStyle:{color:"#333",fontSize:13}},splitNumber:5},series:[{type:"radar",data:s,symbol:"circle",symbolSize:8,areaStyle:{opacity:.15},lineStyle:{width:3},emphasis:{areaStyle:{opacity:.3}}}]};e.setOption(a)},initBarChart(){const t=this.$refs.barChart;if(!t)return;const e=echarts.init(t);this.charts.push(e);const i=this.compareData.map(t=>t.title.length>10?t.title.substr(0,10)+"...":t.title),s=this.compareData.map(t=>this.extractPrice(t.price)),a=this.compareData.map(t=>this.extractArea(t.area)),o={title:{text:"租金与面积对比",left:"center",top:10},tooltip:{trigger:"axis"},legend:{top:30},grid:{top:80,bottom:70,left:60,right:80},xAxis:{type:"category",data:i,axisLabel:{interval:0,rotate:25}},yAxis:[{type:"value",name:"月租金 (元)",position:"left",axisLine:{show:!0,lineStyle:{color:"#ff7675"}}},{type:"value",name:"面积 (㎡)",position:"right",axisLine:{show:!0,lineStyle:{color:"#74b9ff"}}}],series:[{name:"月租金",type:"bar",data:s,itemStyle:{color:"#ff7675"},barWidth:"20%"},{name:"面积",type:"bar",yAxisIndex:1,data:a,itemStyle:{color:"#74b9ff"},barWidth:"20%"}]};e.setOption(o)}}}),Zt=Nt,qt=(0,p.A)(Zt,Ft,jt,!1,null,"42c0587a",null),Ut=qt.exports;o["default"].use(w.Ay);const Yt=[{path:"/",redirect:"/PropertyIllustration"},{path:"/PropertyIllustration",component:pt,meta:{depth:1}},{path:"/RealsceneAnalysis",component:Dt,meta:{depth:2}},{path:"/ThermalComparison",component:Ot,meta:{depth:3}},{path:"/ExchangeSquare",component:Vt,meta:{depth:4}},{path:"/PropertyComparison",component:Ut,meta:{depth:5}}],Jt=new w.Ay({mode:"hash",routes:Yt});var Xt=Jt;o["default"].use(f.Ay);var Kt=new f.Ay.Store({state:{wishList:[],center:[106.5778767,29.5547398],BMAP_COORD_GCJ02:"gcj02",houseDetail:[],parks:[],malls:[],hospitals:[],schools:[]},getters:{getHouseDetail(t){return t.houseDetail}},mutations:{SET_HOUSEDETAIL(t,e){t.houseDetail=e},addToWishList(t,e){t.wishList.find(t=>t.id===e.id)||t.wishList.push(e)},removeFromWishList(t,e){t.wishList=t.wishList.filter(t=>t.id!==e)}},actions:{async loadHouseData({commit:t}){const e=await K.A.get("/data/new_anjuke_yuzhong.json");t("SET_HOUSEDETAIL",e.data)}},modules:{}}),Qt=i(5172);o["default"].use(a()),o["default"].config.productionTip=!1,o["default"].prototype.$mapvthree=Qt,window.MAPV_BASE_URL="/mapvthree",Qt.BaiduMapConfig.ak="Xeg4bBEw1i7zxUxefj6gwbb4qJZxDkWG",new o["default"]({router:Xt,store:Kt,render:t=>t(b)}).$mount("#app")},8535:function(){}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var o=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,function(){i.amdO={}}(),function(){var t=[];i.O=function(e,s,a,o){if(!s){var n=1/0;for(h=0;h<t.length;h++){s=t[h][0],a=t[h][1],o=t[h][2];for(var l=!0,r=0;r<s.length;r++)(!1&o||n>=o)&&Object.keys(i.O).every(function(t){return i.O[t](s[r])})?s.splice(r--,1):(l=!1,o<n&&(n=o));if(l){t.splice(h--,1);var c=a();void 0!==c&&(e=c)}}return e}o=o||0;for(var h=t.length;h>0&&t[h-1][2]>o;h--)t[h]=t[h-1];t[h]=[s,a,o]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={524:0};i.O.j=function(e){return 0===t[e]};var e=function(e,s){var a,o,n=s[0],l=s[1],r=s[2],c=0;if(n.some(function(e){return 0!==t[e]})){for(a in l)i.o(l,a)&&(i.m[a]=l[a]);if(r)var h=r(i)}for(e&&e(s);c<n.length;c++)o=n[c],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(h)},s=self["webpackChunkwork"]=self["webpackChunkwork"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[504],function(){return i(7659)});s=i.O(s)})();
//# sourceMappingURL=app.ee4fc734.js.map